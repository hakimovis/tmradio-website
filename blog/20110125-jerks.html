<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- vim: set ts=2 sts=2 sw=2 et: -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru">
  <head>
    <base href="/"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>О медленных дисках и заикающемся звуке</title>
    <link rel="stylesheet" type="text/css" href="/screen.css?2" media="screen, projection"/>
    <!--
    <link rel="stylesheet" type="text/css" href="/handheld.css" media="handheld"/>
    -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/png"/>
    <style type="text/css">form .text { background: white url(data:image/gif;base64,R0lGODlhAQAFAKIAAPHx8e7u7vv7+/b29v///wAAAAAAAAAAACH5BAAAAAAALAAAAAABAAUAAAMEGDBCCQA7) repeat-x scroll center top; }</style>
    <link rel="alternate" type="application/rss+xml" title="Все обновления" href="/rss.xml"/>
    <link rel="alternate" type="application/rss+xml" title="Так себе новости (подкаст)" href="/news.xml"/>
  </head>
  <body>
    <div id="wrapper">
      <h1>О медленных дисках и заикающемся звуке</h1>
      <!--
      <div id="mnav">
        <ul>
          <li><a href=""></a></li>
        </ul>
      </div>
      -->
      <div id="content">
        <p>Сегодня в течение дня наблюдались периодические подвисания потока на несколько
секунд.  Радио работает на очень слабом сервере (Asus EEE PC 701), который
загрузить довольно легко, однако беглый анализ ситуации показал, что проблема не
связана ни с нагрузкой на процессор, ни на сетевой интерфейс.  Под подозрением
оставались диски.</p>
<p>Оказалось что некто решил загрузить все эпизоды подкаста «<a href="http://afterwednesday.rpod.ru/">Сегодня
четверг</a>», которые хранятся на сайте, который обслуживается машиной, на
которой работает радио.  При этом сами файлы хранились в Amazon S3, а на сервере
был запущен кэширующий прокси-сервер, для снижения количества запросов.  Кэш
используется не очень большой, поэтому прокси-серверу приходилось скачивать
файлы извне, сохраняя их на диске на случай повторного обращения в течение
ближайших нескольких часов.</p>
<p>Вот эта запись файлов размером в несколько десятков мегабайтов и вызывала такую
нагрузку на слабые SSD-диски сервера, что стопорилось даже чтение файлов. 
Проблему решили отказом от использования Amazon S3 в качестве файлового хостинга
(теперь только для бэкапов), также планируется увеличить буфер в ices, чтобы
временные провалы файловой системы не были столь заметны.</p>
<p>Продолжаем выжимать максимум из имеющегося минимума.</p>
        
        <div id="footer">&copy; 2009-2010 Тоже мне радио &middot; <a target="_blank" href="https://github.com/umonkey/tmradio">исходный код сайта</a></div>
      </div>
    </div>
    <ul id="nav"><li class=""><a href="/index.html">Тоже мне радио</a></li><li class=""><a href="/schedule.html">Сетка вещания</a></li><li class=""><a href="/live.html">Прямой эфир</a></li><li class=""><a href="/open.html">Наши принципы</a></li><li class=""><a href="/blog.html">Блог</a></li><li class="group"><a href="/artists.html">Музыкантам</a></li><li class=""><a href="/podcasters.html">Подкастерам</a></li><li class=""><a href="/listeners.html">Слушателям</a></li><li class="group icon icon-rss"><a href="/subscription.html">Подписка</a></li><li class=""><a href="/voicemail.html">Голосовая почта</a></li><li class=""><a href="/feedback.html">Обратная связь</a></li></ul>
  </body>
</html>
