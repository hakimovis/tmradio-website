title: Пост-обработка выпусков ТСН
date: 2011-03-11 10:56
labels: draft, blog, tech, sox, sound processing, обработка звука
author: hex@umonkey.net (umonkey)
---
Запись качественного подкаста — процесс довольно трудоёмкий, отнимающий много
времени.  Причём значительную часть этого времени отнимает обработка звука после
его записи: нормализация, уменьшение шума, удаление возникающих пауз.  Однако
всё это нужно, потому что делает запись более динамичной и удобной для
прослушивания.

Раньше мы вели запись на стороне одного из ведущих, с помощью специальных
программ, записывающих звонки через Skype, затем обрабатывали звук в Audacity. 
Программа довольно медлительная, нормализация двух часов звука и каждый
следующий шаг занимает значительное время — 5-10 минут, в течение которых от
компьютера не отойти и не отвернуться, иначе процесс затянется ещё больше, а
подкаст нужно выложить в вечер записи, который уже почти закончился.  Ко в целом
приятному процессу вещания добавлялась целая куча неинтересной механической
работы.

Сейчас почти весь процесс автоматизирован.  Во-первых, запись эфира ведётся
роботами, которые снимают поток в том виде, в котором его получают слушатели. 
Качество немного хуже, зато у нас есть возможность оценить его своими ушами. 
Во-вторых, вся обработка звука — удаление шума, тишины, нормализация,
кодирование MP3 — выполняются скриптом с помощью утилит sox и lame.  Всё это
делается быстрее, чем в Audacity, и — самое главное — не требует участия
человека.  Разобраться с sox оказалось задачей нетривиальной, поэтому приведу
пример скрипта:

    sox source.wav cleaned.wav noisered noise-sample.noise-profile 0.3
    sox cleaned.wav trimmed.wav silence -l 1 0.2 -50d -1 0.2 -50d norm
    lame -m m -B 64 --resample 44100 trimmed.wav sosonews-xx.mp3

Первая команда удаляет шум.  Она использует «профиль шума» — файл с его
характеристиками.  Для получения этого файла мы выдали в эфир 10 секунд тишины,
из которых затем получили профиль.  Студийная аппаратура у нас постоянная,
поэтому характеристики шума всегда одинаковые, что позволяет использовать один
профиль.  Получить его можно так:

    sox noise-sample.wav noiseprof noise-sample.noise-profile

Следующая команда обрезает все паузы с уровнем ниже -50dB до 500мс и нормализует
звук, а следующая команда кодирует MP3 файл.  В эту цепочку напрашивается
компрессор, но его параметризация довольно сложна и была оставлена на следующий
раз.  Кроме того, эти три команды можно объединить в одну, что тоже будет
описано в будущем.

К описанным действиям добавляется загрузка полученного MP3 файла на сервер и
добавление страницы эпизода на сайт, в которую авторам останется добавить ссылки
на основные новости, вот и вся работа.
